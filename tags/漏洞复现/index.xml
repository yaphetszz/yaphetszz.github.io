<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>漏洞复现 on Y4ph3tS blog</title>
    <link>https://yaphetszz.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</link>
    <description>Recent content in 漏洞复现 on Y4ph3tS blog</description>
    <generator>Hugo</generator>
    <language>en</language>
    <lastBuildDate>Fri, 14 Sep 2018 04:32:27 +0800</lastBuildDate>
    <atom:link href="https://yaphetszz.github.io/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Janus漏洞复现</title>
      <link>https://yaphetszz.github.io/posts/janus%E6%BC%8F%E6%B4%9E/</link>
      <pubDate>Fri, 14 Sep 2018 04:32:27 +0800</pubDate>
      <guid>https://yaphetszz.github.io/posts/janus%E6%BC%8F%E6%B4%9E/</guid>
      <description>&lt;p&gt;&lt;strong&gt;本文所述的一切技术仅供网络安全研究学习之用，请勿用于任何的违法用途，否则由此所产生的一切后果自负！&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Android平台被爆出“核弹级”漏洞Janus（CVE-2017-13156），该漏洞允许攻击者任意修改Android应用中的代码，而不会影响其签名。 众所周知，Android具有签名机制。正常情况下，开发者发布了一个应用，该应用一定需要开发者使用他的私钥对其进行签名。恶意攻击者如果尝试修改了这个应用中的任何一个文件（包括代码和资源等），那么他就必须对APK进行重新签名，否则修改过的应用是无法安装到任何Android设备上的。但如果恶意攻击者用另一把私钥对APK签了名，并将这个修改过的APK对用户手机里的已有应用升级时，就会出现签名不一致的情况。因此，在正常情况下，Android的签名机制起到了防篡改的作用。&lt;/p&gt;&#xA;&lt;p&gt;但如果恶意攻击者利用Janus漏洞，那么恶意攻击者就可以任意地修改一个APK中的代码（包括系统的内置应用），同时却不需要对APK进行重新签名。换句话说，用这种方式修改过的APK，Android系统会认为它的签名和官方的签名是一致的，但在这个APK运行时，执行的却是恶意攻击者的代码。恶意攻击者利用这个修改过的APK，就可以用来覆盖安装原官方应用（包括系统的内置应用）。由此可见，该漏洞危害极大，而且影响的不仅是手机，而是所有使用Android操作系统的设备。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/b85e2cb5-e399-4d24-b35b-13fc0d299c73.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;主要问题是没有使用V2签名&#xA;使用getapkinfo查看应用信息，未使用V2签名&#xA;&lt;img src=&#34;../index_files/617873ce-0216-4a53-a57c-65a1019a7fad.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;为了避免误报问题，解压安装包后查看签名.SF文件，可以看到没有加V2签名&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/47d5e25b-76e4-4167-ab4c-6832cc37a74e.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;使用一款已经添加了V2签名的APP来查看可以看到X-Android-APK-Signed: 2字段&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/5d285604-ed4d-4835-bd9c-506a652e467a.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;提取出文件中的dex，并进行反编译，此处采用baksmali&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;java -jar baksmali-2.5.2.jar d classes.dex&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;../index_files/64a1631e-e126-4d69-8c50-de2063bb64d4.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;进入默认输出文件夹，可以看到已经反编译出了smali文件&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/f86e352b-587d-4aea-aa5f-a84eca1a572b.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;使用命令&lt;/p&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;find . -name &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;\*.smali&amp;#34;&lt;/span&gt; | xargs grep &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;const&amp;#34;&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;../index_files/df8d5baf-b406-4331-ae5f-cb871f725977.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;可以看到在Utils.smali文件中大量信息&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/274ca1c7-2a8e-45a4-87b8-2f900490a26d.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;选择其中的域名信息，&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/26ce6960-e553-412e-8946-b14ddd2c1f93.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;修改为evil.com&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/cf2a01e2-95ae-4b6b-9931-e36936365dbd.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;修改后保存，重打包成为新的dex，重新生成的文件为out.dex&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/cbffbcf5-4418-450c-b27c-88f79edee3ab.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;使用利用工具生成恶意的APK包&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/28fcce24-8a3a-4d75-bbc7-e1ca1e9c7cd0.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;通过工具对比可见两个文件的签名文件校验结果完全一致&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;../index_files/7d3df106-ed8c-4f40-b137-0a708b2a9aec.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
